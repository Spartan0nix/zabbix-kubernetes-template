{
    "zabbix_export": {
        "version": "5.4",
        "date": "2021-10-07T19:22:03Z",
        "groups": [
            {
                "uuid": "7df96b18c230490a9a0a9e2307226338",
                "name": "Templates"
            },
            {
                "uuid": "9a1895ed9c4740469b84deb3263a7671",
                "name": "Templates/Cloud_Monitoring"
            }
        ],
        "templates": [
            {
                "uuid": "2c26e90729e54e3fbc3119878a88bea0",
                "template": "Template Kubernetes",
                "name": "Template Kubernetes",
                "description": "Get Kubernetes cluster metrics from the API server. \n\nCheck the Kubernetes documentation for more information\nhttps://kubernetes.io/docs/concepts/overview/kubernetes-api/\n\nMacros :\n{$API_SERVER} => API server url (https://<IP>:<Port>\n{$API_TOKEN} => Token from the service account used to access the API",
                "groups": [
                    {
                        "name": "Templates"
                    },
                    {
                        "name": "Templates/Cloud_Monitoring"
                    }
                ],
                "items": [
                    {
                        "uuid": "5832013e95644b339de56a91d5c1e527",
                        "name": "Kubernetes master endpoint",
                        "type": "HTTP_AGENT",
                        "key": "kubernetes.master.endpoint",
                        "history": "2w",
                        "trends": "0",
                        "value_type": "TEXT",
                        "timeout": "30s",
                        "url": "{$API_SERVER}/api/v1/endpoints",
                        "headers": [
                            {
                                "name": "Authorization",
                                "value": "Bearer {$API_TOKEN}"
                            }
                        ],
                        "tags": [
                            {
                                "tag": "Application",
                                "value": "Kubernetes"
                            },
                            {
                                "tag": "Service",
                                "value": "API"
                            }
                        ],
                        "triggers": [
                            {
                                "uuid": "e7d5568cdb3a426a98dcff81beac70d9",
                                "expression": "nodata(/Template Kubernetes/kubernetes.master.endpoint,5m)=1",
                                "name": "Cluster endpoints are no longer monitored",
                                "priority": "AVERAGE",
                                "dependencies": [
                                    {
                                        "name": "Cluster is not reachable",
                                        "expression": "nodata(/Template Kubernetes/kubernetes.master.node,5m)=1 or nodata(/Template Kubernetes/kubernetes.master.pod,5m)=1 or nodata(/Template Kubernetes/kubernetes.master.endpoint,5m)=1 or nodata(/Template Kubernetes/kubernetes.master.service,5m)=1"
                                    }
                                ],
                                "tags": [
                                    {
                                        "tag": "Application",
                                        "value": "Kubernetes"
                                    },
                                    {
                                        "tag": "Service",
                                        "value": "Availablity"
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        "uuid": "0dc8bef7b0f2474c867606b5dd472061",
                        "name": "Kubernetes master node",
                        "type": "HTTP_AGENT",
                        "key": "kubernetes.master.node",
                        "history": "2w",
                        "trends": "0",
                        "value_type": "TEXT",
                        "timeout": "30s",
                        "url": "{$API_SERVER}/api/v1/nodes",
                        "headers": [
                            {
                                "name": "Authorization",
                                "value": "Bearer {$API_TOKEN}"
                            }
                        ],
                        "tags": [
                            {
                                "tag": "Application",
                                "value": "Kubernetes"
                            },
                            {
                                "tag": "Service",
                                "value": "API"
                            }
                        ],
                        "triggers": [
                            {
                                "uuid": "d94660f653f84355a9c908d72b727810",
                                "expression": "nodata(/Template Kubernetes/kubernetes.master.node,5m)=1",
                                "name": "Cluster nodes are no longer monitored",
                                "priority": "AVERAGE",
                                "dependencies": [
                                    {
                                        "name": "Cluster is not reachable",
                                        "expression": "nodata(/Template Kubernetes/kubernetes.master.node,5m)=1 or nodata(/Template Kubernetes/kubernetes.master.pod,5m)=1 or nodata(/Template Kubernetes/kubernetes.master.endpoint,5m)=1 or nodata(/Template Kubernetes/kubernetes.master.service,5m)=1"
                                    }
                                ],
                                "tags": [
                                    {
                                        "tag": "Application",
                                        "value": "Kubernetes"
                                    },
                                    {
                                        "tag": "Service",
                                        "value": "Availablity"
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        "uuid": "9d04dc10676b4124b1098b9562efbb7c",
                        "name": "Kubernetes master pod",
                        "type": "HTTP_AGENT",
                        "key": "kubernetes.master.pod",
                        "history": "2w",
                        "trends": "0",
                        "value_type": "TEXT",
                        "timeout": "30s",
                        "url": "{$API_SERVER}/api/v1/pods",
                        "headers": [
                            {
                                "name": "Authorization",
                                "value": "Bearer {$API_TOKEN}"
                            }
                        ],
                        "tags": [
                            {
                                "tag": "Application",
                                "value": "Kubernetes"
                            },
                            {
                                "tag": "Service",
                                "value": "API"
                            }
                        ]
                    },
                    {
                        "uuid": "3fbdabe60c8d4fd98b205e821d444aee",
                        "name": "Kubernetes master service",
                        "type": "HTTP_AGENT",
                        "key": "kubernetes.master.service",
                        "history": "2w",
                        "trends": "0",
                        "value_type": "TEXT",
                        "timeout": "30s",
                        "url": "{$API_SERVER}/api/v1/services",
                        "headers": [
                            {
                                "name": "Authorization",
                                "value": "Bearer {$API_TOKEN}"
                            }
                        ],
                        "tags": [
                            {
                                "tag": "Application",
                                "value": "Kubernetes"
                            },
                            {
                                "tag": "Service",
                                "value": "API"
                            }
                        ],
                        "triggers": [
                            {
                                "uuid": "5abb0ff004294fa7b148a011a4eb3439",
                                "expression": "nodata(/Template Kubernetes/kubernetes.master.service,5m)=1",
                                "name": "Cluster services are no longer monitored",
                                "priority": "AVERAGE",
                                "dependencies": [
                                    {
                                        "name": "Cluster is not reachable",
                                        "expression": "nodata(/Template Kubernetes/kubernetes.master.node,5m)=1 or nodata(/Template Kubernetes/kubernetes.master.pod,5m)=1 or nodata(/Template Kubernetes/kubernetes.master.endpoint,5m)=1 or nodata(/Template Kubernetes/kubernetes.master.service,5m)=1"
                                    }
                                ],
                                "tags": [
                                    {
                                        "tag": "Application",
                                        "value": "Kubernetes"
                                    },
                                    {
                                        "tag": "Service",
                                        "value": "Availablity"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "discovery_rules": [
                    {
                        "uuid": "ddea415080ff4202ad27e4e54397458f",
                        "name": "Endpoints discovery",
                        "type": "DEPENDENT",
                        "key": "kubernetes.endpoints.discovery",
                        "delay": "0",
                        "filter": {
                            "evaltype": "AND",
                            "conditions": [
                                {
                                    "macro": "{#ENDPOINT_NAME}",
                                    "operator": "EXISTS",
                                    "formulaid": "B"
                                },
                                {
                                    "macro": "{#ENDPOINT_IP}",
                                    "operator": "EXISTS",
                                    "formulaid": "A"
                                },
                                {
                                    "macro": "{#ENDPOINT_PORT}",
                                    "operator": "EXISTS",
                                    "formulaid": "C"
                                }
                            ]
                        },
                        "lifetime": "1d",
                        "item_prototypes": [
                            {
                                "uuid": "578000f26b7641a98e999ce46460e6bd",
                                "name": "Endpoint {#ENDPOINT_NAME} : {#ENDPOINT_IP}:{#ENDPOINT_PORT}",
                                "type": "DEPENDENT",
                                "key": "kubernetes.endpoint[{#ENDPOINT_NAME},details]",
                                "delay": "0",
                                "history": "2w",
                                "trends": "0",
                                "value_type": "TEXT",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.items[?(@.metadata.name=='{#ENDPOINT_NAME}')]"
                                        ]
                                    }
                                ],
                                "master_item": {
                                    "key": "kubernetes.master.endpoint"
                                },
                                "tags": [
                                    {
                                        "tag": "Application",
                                        "value": "Kubernetes"
                                    },
                                    {
                                        "tag": "Service",
                                        "value": "Network"
                                    }
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "kubernetes.master.endpoint"
                        },
                        "lld_macro_paths": [
                            {
                                "lld_macro": "{#ENDPOINT_NAME}",
                                "path": "$.metadata.name"
                            },
                            {
                                "lld_macro": "{#ENDPOINT_IP}",
                                "path": "$.subsets[:].addresses[:].ip"
                            },
                            {
                                "lld_macro": "{#ENDPOINT_PORT}",
                                "path": "$.subsets[:].ports[:].port"
                            }
                        ],
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.items[:]"
                                ]
                            }
                        ]
                    },
                    {
                        "uuid": "21cf328d34e84f35ad0dcf1406323c6b",
                        "name": "Nodes discovery",
                        "type": "DEPENDENT",
                        "key": "kubernetes.nodes.discovery",
                        "delay": "0",
                        "lifetime": "1d",
                        "item_prototypes": [
                            {
                                "uuid": "a370353277b04c7da708012b04c2eab0",
                                "name": "Node {#NODE_NAME} : DiskPressure",
                                "type": "DEPENDENT",
                                "key": "kubernetes.node[{#NODE_NAME},diskPressure]",
                                "delay": "0",
                                "history": "2w",
                                "trends": "0",
                                "value_type": "TEXT",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.items[?(@.metadata.name=='{#NODE_NAME}')].status.conditions[?(@.type=='DiskPressure')].status.first()"
                                        ]
                                    }
                                ],
                                "master_item": {
                                    "key": "kubernetes.master.node"
                                },
                                "tags": [
                                    {
                                        "tag": "Application",
                                        "value": "Kubernetes"
                                    },
                                    {
                                        "tag": "Service",
                                        "value": "File System"
                                    }
                                ],
                                "trigger_prototypes": [
                                    {
                                        "uuid": "e4f961a811524ca1a7ce8321587aedde",
                                        "expression": "last(/Template Kubernetes/kubernetes.node[{#NODE_NAME},diskPressure],#5)=\"True\"",
                                        "name": "Node {#NODE_NAME} DiskPressure is True",
                                        "priority": "AVERAGE",
                                        "tags": [
                                            {
                                                "tag": "Application",
                                                "value": "Storage"
                                            },
                                            {
                                                "tag": "Service",
                                                "value": "Kubernetes"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "uuid": "c96be1a403284a0d90ecd964bc98daf2",
                                "name": "Node {#NODE_NAME} : MemoryPressure",
                                "type": "DEPENDENT",
                                "key": "kubernetes.node[{#NODE_NAME},memoryPressure]",
                                "delay": "0",
                                "history": "2w",
                                "trends": "0",
                                "value_type": "TEXT",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.items[?(@.metadata.name=='{#NODE_NAME}')].status.conditions[?(@.type=='MemoryPressure')].status.first()"
                                        ]
                                    }
                                ],
                                "master_item": {
                                    "key": "kubernetes.master.node"
                                },
                                "tags": [
                                    {
                                        "tag": "Application",
                                        "value": "Kubernetes"
                                    },
                                    {
                                        "tag": "Service",
                                        "value": "Memory"
                                    }
                                ],
                                "trigger_prototypes": [
                                    {
                                        "uuid": "cbf69da42ef442eb9e2c2265130105be",
                                        "expression": "last(/Template Kubernetes/kubernetes.node[{#NODE_NAME},memoryPressure],#5)=\"True\"",
                                        "name": "Node {#NODE_NAME} MemoryPressure is True",
                                        "priority": "AVERAGE",
                                        "tags": [
                                            {
                                                "tag": "Application",
                                                "value": "Memory"
                                            },
                                            {
                                                "tag": "Service",
                                                "value": "Kubernetes"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "uuid": "9f0ae18daac447be9a8b77df19c7d80c",
                                "name": "Node name : {#NODE_NAME}",
                                "type": "DEPENDENT",
                                "key": "kubernetes.node[{#NODE_NAME},name]",
                                "delay": "0",
                                "history": "2w",
                                "trends": "0",
                                "value_type": "TEXT",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.items[?(@.metadata.name=='{#NODE_NAME}')].metadata.name.first()"
                                        ]
                                    }
                                ],
                                "master_item": {
                                    "key": "kubernetes.master.node"
                                },
                                "tags": [
                                    {
                                        "tag": "Application",
                                        "value": "Kubernetes"
                                    },
                                    {
                                        "tag": "Service",
                                        "value": "General"
                                    }
                                ]
                            },
                            {
                                "uuid": "77d4dbe291c6403f9fe31c53dc92d834",
                                "name": "Node {#NODE_NAME} : PIDPressure",
                                "type": "DEPENDENT",
                                "key": "kubernetes.node[{#NODE_NAME},PIDPressure]",
                                "delay": "0",
                                "history": "2w",
                                "trends": "0",
                                "value_type": "TEXT",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.items[?(@.metadata.name=='{#NODE_NAME}')].status.conditions[?(@.type=='PIDPressure')].status.first()"
                                        ]
                                    }
                                ],
                                "master_item": {
                                    "key": "kubernetes.master.node"
                                },
                                "tags": [
                                    {
                                        "tag": "Application",
                                        "value": "Kubernetes"
                                    },
                                    {
                                        "tag": "Service",
                                        "value": "System"
                                    }
                                ],
                                "trigger_prototypes": [
                                    {
                                        "uuid": "a55af0f6ee474c158de71cfbadf3088f",
                                        "expression": "last(/Template Kubernetes/kubernetes.node[{#NODE_NAME},PIDPressure],#5)=\"True\"",
                                        "name": "Node {#NODE_NAME} PIDPressure is True",
                                        "priority": "AVERAGE",
                                        "tags": [
                                            {
                                                "tag": "Application",
                                                "value": "System"
                                            },
                                            {
                                                "tag": "Service",
                                                "value": "Kubernetes"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "uuid": "dbc6894d24fd485da54c822f9c981314",
                                "name": "Node {#NODE_NAME} : Operational Status",
                                "type": "DEPENDENT",
                                "key": "kubernetes.node[{#NODE_NAME},ready]",
                                "delay": "0",
                                "history": "2w",
                                "trends": "0",
                                "value_type": "TEXT",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.items[?(@.metadata.name=='{#NODE_NAME}')].status.conditions[?(@.type=='Ready')].status.first()"
                                        ]
                                    }
                                ],
                                "master_item": {
                                    "key": "kubernetes.master.node"
                                },
                                "tags": [
                                    {
                                        "tag": "Application",
                                        "value": "Kubernetes"
                                    },
                                    {
                                        "tag": "Service",
                                        "value": "Availablity"
                                    }
                                ],
                                "trigger_prototypes": [
                                    {
                                        "uuid": "e170651ef74d4e84a681453e94c3e2c3",
                                        "expression": "last(/Template Kubernetes/kubernetes.node[{#NODE_NAME},ready],#2)=\"False\"",
                                        "name": "Node {#NODE_NAME} is Down",
                                        "priority": "HIGH",
                                        "tags": [
                                            {
                                                "tag": "Application",
                                                "value": "System"
                                            },
                                            {
                                                "tag": "Service",
                                                "value": "Kubernetes"
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "kubernetes.master.node"
                        },
                        "lld_macro_paths": [
                            {
                                "lld_macro": "{#NODE_NAME}",
                                "path": "$.name"
                            }
                        ],
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.items[:].metadata"
                                ]
                            }
                        ]
                    },
                    {
                        "uuid": "199a7e088d084a9482218d5ba3778a16",
                        "name": "Pods discovery",
                        "type": "DEPENDENT",
                        "key": "kubernetes.pods.discovery",
                        "delay": "0",
                        "lifetime": "1d",
                        "item_prototypes": [
                            {
                                "uuid": "a90c646fa5be47c19838dcf1e543a1e8",
                                "name": "Pod name :  {#POD_NAME}",
                                "type": "DEPENDENT",
                                "key": "kubernetes.pod[{#POD_NAME},name]",
                                "delay": "0",
                                "history": "2w",
                                "trends": "0",
                                "value_type": "TEXT",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.items[?(@.metadata.name=='{#POD_NAME}')].metadata.name.first()"
                                        ]
                                    }
                                ],
                                "master_item": {
                                    "key": "kubernetes.master.pod"
                                },
                                "tags": [
                                    {
                                        "tag": "Application",
                                        "value": "Kubernetes"
                                    },
                                    {
                                        "tag": "Service",
                                        "value": "General"
                                    }
                                ]
                            },
                            {
                                "uuid": "cfa1237aecb54c148273221ef5daca15",
                                "name": "Pod {#POD_NAME} : Status",
                                "type": "DEPENDENT",
                                "key": "kubernetes.pod[{#POD_NAME},status]",
                                "delay": "0",
                                "history": "2w",
                                "trends": "0",
                                "value_type": "TEXT",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.items[?(@.metadata.name=='{#POD_NAME}')].status.phase.first()"
                                        ]
                                    }
                                ],
                                "master_item": {
                                    "key": "kubernetes.master.pod"
                                },
                                "tags": [
                                    {
                                        "tag": "Application",
                                        "value": "Kubernetes"
                                    },
                                    {
                                        "tag": "Service",
                                        "value": "Availability"
                                    }
                                ],
                                "trigger_prototypes": [
                                    {
                                        "uuid": "21201c436b06416eb668c76514458825",
                                        "expression": "last(/Template Kubernetes/kubernetes.pod[{#POD_NAME},status],#5)<>\"Running\"",
                                        "name": "Pod {#POD_NAME} is not running",
                                        "priority": "HIGH",
                                        "tags": [
                                            {
                                                "tag": "Application",
                                                "value": "System"
                                            },
                                            {
                                                "tag": "Service",
                                                "value": "Kubernetes"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "uuid": "1f8211121ac14ef281a867f05f494335",
                                "name": "Pod {#POD_NAME} : Volumes list",
                                "type": "DEPENDENT",
                                "key": "kubernetes.pod[{#POD_NAME},volumesList]",
                                "delay": "0",
                                "history": "2w",
                                "trends": "0",
                                "value_type": "TEXT",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.items[?(@.metadata.name=='{#POD_NAME}')].spec.volumes[:].name"
                                        ]
                                    }
                                ],
                                "master_item": {
                                    "key": "kubernetes.master.pod"
                                },
                                "tags": [
                                    {
                                        "tag": "Application",
                                        "value": "Kubernetes"
                                    },
                                    {
                                        "tag": "Service",
                                        "value": "File System"
                                    }
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "kubernetes.master.pod"
                        },
                        "lld_macro_paths": [
                            {
                                "lld_macro": "{#POD_NAME}",
                                "path": "$.name"
                            }
                        ],
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.items[:].metadata"
                                ]
                            }
                        ]
                    },
                    {
                        "uuid": "56dccd5e5c4242adb55fabf3dc9f61a9",
                        "name": "Services discovery",
                        "type": "DEPENDENT",
                        "key": "kubernetes.services.discovery",
                        "delay": "0",
                        "lifetime": "1d",
                        "item_prototypes": [
                            {
                                "uuid": "221cce739e9545e09680f59a2c80d69a",
                                "name": "Service {#SERVICE_NAME} : {#SERVICE_IP}:{#SERVICE_PORT}",
                                "type": "DEPENDENT",
                                "key": "kubernetes.node[{#NODE_NAME},details]",
                                "delay": "0",
                                "history": "2w",
                                "trends": "0",
                                "value_type": "TEXT",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.items[?(@.metadata.name=='{#SERVICE_NAME}')].spec"
                                        ]
                                    }
                                ],
                                "master_item": {
                                    "key": "kubernetes.master.service"
                                },
                                "tags": [
                                    {
                                        "tag": "Application",
                                        "value": "Kubernetes"
                                    },
                                    {
                                        "tag": "Service",
                                        "value": "System"
                                    }
                                ]
                            },
                            {
                                "uuid": "0a107958c6af49089e6bbfb1e4b58818",
                                "name": "Service {#SERVICE_NAME} : Type",
                                "type": "DEPENDENT",
                                "key": "kubernetes.service[{#SERVICE_NAME},type]",
                                "delay": "0",
                                "history": "2w",
                                "trends": "0",
                                "value_type": "TEXT",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.items[?(@.metadata.name=='{#SERVICE_NAME}')].spec.type.first()"
                                        ]
                                    }
                                ],
                                "master_item": {
                                    "key": "kubernetes.master.service"
                                },
                                "tags": [
                                    {
                                        "tag": "Application",
                                        "value": "Kubernetes"
                                    },
                                    {
                                        "tag": "Service",
                                        "value": "General"
                                    }
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "kubernetes.master.service"
                        },
                        "lld_macro_paths": [
                            {
                                "lld_macro": "{#SERVICE_NAME}",
                                "path": "$.metadata.name"
                            },
                            {
                                "lld_macro": "{#SERVICE_TYPE}",
                                "path": "$.spec.type"
                            },
                            {
                                "lld_macro": "{#SERVICE_IP}",
                                "path": "$.spec.clusterIPs[:]"
                            },
                            {
                                "lld_macro": "{#SERVICE_PORT}",
                                "path": "$.spec.ports[:].port"
                            }
                        ],
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.items[:]"
                                ]
                            }
                        ]
                    }
                ],
                "tags": [
                    {
                        "tag": "Application",
                        "value": "Kubernetes"
                    }
                ],
                "macros": [
                    {
                        "macro": "{$API_SERVER}",
                        "value": "https://127.0.0.1:8443"
                    },
                    {
                        "macro": "{$API_TOKEN}"
                    }
                ]
            }
        ],
        "triggers": [
            {
                "uuid": "6319e2633088463aba370604cd1ba6c8",
                "expression": "nodata(/Template Kubernetes/kubernetes.master.node,5m)=1 or nodata(/Template Kubernetes/kubernetes.master.pod,5m)=1 or nodata(/Template Kubernetes/kubernetes.master.endpoint,5m)=1 or nodata(/Template Kubernetes/kubernetes.master.service,5m)=1",
                "name": "Cluster is not reachable",
                "priority": "HIGH",
                "tags": [
                    {
                        "tag": "Application",
                        "value": "Kubernetes"
                    },
                    {
                        "tag": "Service",
                        "value": "Availablity"
                    }
                ]
            }
        ]
    }
}